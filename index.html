<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìì¬ ê²¬ì  ë§ˆìŠ¤í„° ì‹œìŠ¤í…œ</title>
    <style>
        :root {
            --ios-blue: #007AFF; --ios-green: #34C759; --ios-orange: #FF9500;
            --ios-purple: #5856D6; --ios-bg: #F2F2F7; --ios-card: #FFFFFF;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background-color: var(--ios-bg); margin: 0; padding: 15px; -webkit-font-smoothing: antialiased; }
        .container { max-width: 500px; margin: 0 auto; padding-bottom: 120px; }
        
        .mode-selector { display: flex; background: #E5E5EA; border-radius: 10px; padding: 2px; margin-bottom: 20px; }
        .mode-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .mode-btn.active { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .card { background: var(--ios-card); border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { font-size: 20px; font-weight: 700; text-align: center; margin-bottom: 20px; }
        
        .input-group { margin-bottom: 12px; }
        label { display: block; font-size: 13px; font-weight: 500; color: #8E8E93; margin: 0 0 5px 5px; }
        input, select, textarea { width: 100%; padding: 12px; border: none; background: #F2F2F7; border-radius: 12px; font-size: 15px; outline: none; box-sizing: border-box; }
        textarea { height: 80px; resize: none; border: 1px dashed var(--ios-blue); }

        .btn { width: 100%; border: none; border-radius: 12px; font-weight: 600; padding: 14px; cursor: pointer; margin-top: 10px; color: white; transition: 0.2s; }
        .btn:active { opacity: 0.7; }
        .btn-request { background: var(--ios-blue); }
        .btn-calculate { background: var(--ios-green); }
        .btn-pdf { background: var(--ios-purple); margin-top: 20px; }
        .btn-parse { background: #1C1C1E; font-size: 13px; padding: 10px; margin-top: 5px; }

        .item { background: white; padding: 12px; border-radius: 12px; margin-bottom: 8px; border-left: 5px solid #CCC; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .admin-only { display: none; }
        
        .total-card { background: #1C1C1E; color: white; border-radius: 15px; padding: 15px; margin-top: 15px; display: none; }
        .date-info { text-align: center; font-size: 11px; color: #8E8E93; margin-bottom: 10px; }

        @media print {
            .mode-selector, .card, .btn, .ad-box, .del-btn, .admin-parse-area { display: none !important; }
            body { background: white; padding: 0; }
            .total-card { display: block !important; background: #F9F9F9 !important; color: #000 !important; border: 1px solid #000; }
            .item { border: 1px solid #EEE; border-left: 5px solid #CCC; box-shadow: none; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="mode-selector">
        <button id="user-mode-btn" class="mode-btn active" onclick="switchMode('user')">ê³ ê°ìš© (ìš”ì²­)</button>
        <button id="admin-mode-btn" class="mode-btn" onclick="switchMode('admin')">ì—…ì²´ìš© (ì‚°ì¶œ)</button>
    </div>

    <div class="card admin-only admin-parse-area" style="border: 2px solid var(--ios-blue);">
        <label style="color:var(--ios-blue); font-weight:bold;">ğŸ“© ë°›ì€ ë¬¸ì ë¶™ì—¬ë„£ê¸° (ìë™ ë¶„ì„)</label>
        <textarea id="rawText" placeholder="ê³ ê°ì´ ë³´ë‚¸ ê²¬ì  ìš”ì²­ ë¬¸ìë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
        <button class="btn btn-parse" onclick="parseText()">ìë™ ë¶„ì„ í›„ ëª©ë¡ ì¶”ê°€</button>
    </div>

    <div class="card">
        <h2 id="title">ìì¬ ê²¬ì  ìš”ì²­</h2>
        
        <div class="input-group">
            <label>ìì¬</label>
            <select id="material">
                <option value="7.93">SUS303/304</option>
                <option value="7.85">SS400 (ì¼ë°˜ê°•)</option>
                <option value="2.7">ì•Œë£¨ë¯¸ëŠ„</option>
            </select>
        </div>

        <div class="input-group">
            <label>í˜•íƒœ</label>
            <select id="shape" onchange="toggleInputs()">
                <option value="square">ì‚¬ê°íŒ (ê°€ë¡œxì„¸ë¡œ)</option>
                <option value="circle">í™˜ë´‰ (ì§€ë¦„)</option>
            </select>
        </div>

        <div id="square-inputs" class="input-group">
            <label>ê°€ë¡œ x ì„¸ë¡œ (mm)</label>
            <div style="display:flex; gap:5px;"><input type="number" id="w" placeholder="ê°€ë¡œ"><input type="number" id="l" placeholder="ì„¸ë¡œ"></div>
        </div>
        <div id="circle-inputs" class="input-group" style="display:none;">
            <label>ì§€ë¦„ (D mm)</label>
            <input type="number" id="dia" placeholder="ì§€ë¦„">
        </div>

        <div class="input-group">
            <label>ë‘ê»˜(T) / ê¸¸ì´(L) mm</label>
            <input type="number" id="t" placeholder="ì…ë ¥">
        </div>

        <div class="input-group admin-only">
            <label>ì ìš© ë‹¨ê°€ (ì›/kg)</label>
            <input type="number" id="unitPrice" value="5000">
        </div>

        <button id="main-btn" class="btn btn-request" onclick="addItem()">ëª©ë¡ì— ì¶”ê°€</button>
    </div>

    <div id="items"></div>

    <div class="total-card admin-only">
        <div id="print-date-display" class="date-info" style="color: #fff;"></div>
        <div style="display:flex; justify-content:space-between; font-size:14px;"><span>ì´ ì¤‘ëŸ‰</span><span id="total-w">0.000</span>kg</div>
        <div style="display:flex; justify-content:space-between; margin-top:10px; border-top:1px solid #444; padding-top:10px;">
            <span>ìµœì¢… í•©ê³„</span><strong id="total-p" style="color:#FFD60A; font-size:20px;">0</strong>ì›
        </div>
    </div>

    <button class="btn btn-pdf admin-only" onclick="generatePdf()">ğŸ“„ ì •ì‹ ê²¬ì ì„œ PDF ë°œí–‰</button>
    <button id="send-btn" class="btn btn-request" onclick="sendToOwner()">ğŸ“© ì—…ì²´ì— ê²¬ì  ìš”ì²­ (ë¬¸ìì „ì†¡)</button>
</div>

<script>
    let itemList = [];
    let currentMode = 'user';

    function switchMode(mode) {
        currentMode = mode;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(mode + '-mode-btn').classList.add('active');
        
        const adminElements = document.querySelectorAll('.admin-only');
        const title = document.getElementById('title');
        const mainBtn = document.getElementById('main-btn');
        const sendBtn = document.getElementById('send-btn');

        if (mode === 'admin') {
            adminElements.forEach(e => e.style.display = 'block');
            title.innerText = "ìì¬ ê²¬ì  ì‚°ì¶œ (ê´€ë¦¬ì)";
            mainBtn.innerText = "ìˆ˜ë™ ì¶”ê°€";
            mainBtn.className = "btn btn-calculate";
            sendBtn.style.display = 'none';
        } else {
            adminElements.forEach(e => e.style.display = 'none');
            title.innerText = "ìì¬ ê²¬ì  ìš”ì²­";
            mainBtn.innerText = "ëª©ë¡ì— ì¶”ê°€";
            mainBtn.className = "btn btn-request";
            sendBtn.style.display = 'block';
        }
        renderList();
    }

    function toggleInputs() {
        const s = document.getElementById('shape').value;
        document.getElementById('square-inputs').style.display = (s === 'square') ? 'block' : 'none';
        document.getElementById('circle-inputs').style.display = (s === 'circle') ? 'block' : 'none';
    }

    function addItem() {
        const mat = document.getElementById('material');
        const opt = mat.options[mat.selectedIndex];
        const g = parseFloat(opt.value);
        const shape = document.getElementById('shape').value;
        const t = document.getElementById('t').value / 10;
        const up = document.getElementById('unitPrice').value;
        
        let wgt = 0; let txt = "";
        if (shape === 'square') {
            const w = document.getElementById('w').value / 10;
            const l = document.getElementById('l').value / 10;
            if(!w || !l || !t) return alert("ì¹˜ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            wgt = (w * l * t * g) / 1000;
            txt = `${opt.text}(ì‚¬ê°) ${w*10}*${l*10}*${t*10}`;
        } else {
            const d = document.getElementById('dia').value / 10;
            if(!d || !t) return alert("ì§€ë¦„ê³¼ ê¸¸ì´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            wgt = (Math.pow(d/2, 2) * Math.PI * t * g) / 1000;
            txt = `${opt.text}(í™˜ë´‰) D${d*10}*L${t*10}`;
        }
        itemList.push({ id: Date.now(), txt, weight: wgt, cost: Math.round(wgt * up) });
        renderList();
    }

    // ğŸš€ ë¬¸ì ìë™ ë¶„ì„ ë¡œì§
    function parseText() {
        const rawText = document.getElementById('rawText').value;
        if(!rawText) return alert("ë¬¸ì ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
        
        const up = document.getElementById('unitPrice').value;
        const lines = rawText.split('\n');
        let count = 0;

        lines.forEach(line => {
            // ì •ê·œì‹ìœ¼ë¡œ ìˆ«ì*ìˆ«ì*ìˆ«ì í˜•íƒœ ì¶”ì¶œ
            const match = line.match(/(\d+(?:\.\d+)?)\*(\d+(?:\.\d+)?)\*(\d+(?:\.\d+)?)/);
            if (match) {
                const w = parseFloat(match[1]) / 10;
                const l = parseFloat(match[2]) / 10;
                const t = parseFloat(match[3]) / 10;
                
                // ìì¬ íŒë³„ (ë¬¸ìì—´ì— í¬í•¨ëœ ë‹¨ì–´ ê¸°ì¤€)
                let g = 7.93; let matName = "SUS303/304";
                if(line.includes("SS400") || line.includes("ì¼ë°˜ê°•")) { g = 7.85; matName = "SS400"; }
                else if(line.includes("ì•Œë£¨ë¯¸ëŠ„") || line.includes("AL")) { g = 2.7; matName = "ì•Œë£¨ë¯¸ëŠ„"; }

                const wgt = (w * l * t * g) / 1000;
                itemList.push({ id: Date.now() + Math.random(), txt: `${matName}(ì‚¬ê°) ${w*10}*${l*10}*${t*10}`, weight: wgt, cost: Math.round(wgt * up) });
                count++;
            }
        });

        if(count > 0) {
            alert(count + "ê°œì˜ í•­ëª©ì„ ë¶„ì„í•˜ì—¬ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.");
            document.getElementById('rawText').value = "";
            renderList();
        } else {
            alert("ë¶„ì„ ê°€ëŠ¥í•œ ê·œê²© í˜•ì‹ì´ ì—†ìŠµë‹ˆë‹¤. (ì˜ˆ: 100*100*10)");
        }
    }

    function renderList() {
        const container = document.getElementById('items');
        container.innerHTML = ""; let tw = 0; let tp = 0;
        itemList.forEach((item, i) => {
            tw += item.weight; tp += item.cost;
            const div = document.createElement('div');
            div.className = 'item';
            div.innerHTML = `<b>${i+1}. ${item.txt}</b>` + 
                (currentMode === 'admin' ? `<p>${item.weight.toFixed(3)}kg / ${item.cost.toLocaleString()}ì›</p>` : `<p>ê²¬ì  ëŒ€ê¸° ì¤‘</p>`) +
                `<button onclick="deleteItem(${item.id})" style="position:absolute; right:10px; top:10px; border:none; background:none; color:red; cursor:pointer;">ì‚­ì œ</button>`;
            container.appendChild(div);
        });
        document.getElementById('total-w').innerText = tw.toFixed(3);
        document.getElementById('total-p').innerText = tp.toLocaleString();
    }

    function deleteItem(id) { itemList = itemList.filter(i => i.id !== id); renderList(); }

    function generatePdf() {
        const now = new Date();
        document.getElementById('print-date-display').innerText = "ë°œí–‰ì¼ì‹œ: " + now.toLocaleString();
        window.print();
    }

    function sendToOwner() {
        if(itemList.length === 0) return alert("ëª©ë¡ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.");
        let s = "[ìì¬ ê²¬ì  ìš”ì²­]\n";
        itemList.forEach((item, i) => { s += `${i+1}. ${item.txt}\n`; });
        s += "\nê²¬ì  ë¶€íƒë“œë¦½ë‹ˆë‹¤.";
        location.href = `sms:01000000000?body=${encodeURIComponent(s)}`;
    }
</script>
</body>
</html>
